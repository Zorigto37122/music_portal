{% extends 'music/base.html' %}

{% block content %}
<div class="glass-card" style="padding: 40px; margin-bottom: 40px; display: flex; gap: 40px; align-items: flex-end;">
    <div
        style="width: 250px; height: 250px; border-radius: 12px; overflow: hidden; box-shadow: 0 20px 50px rgba(0,0,0,0.5); flex-shrink: 0;">
        {% if album.cover_image %}
        <img src="{{ album.cover_image.url }}" alt="{{ album.title }}"
            style="width: 100%; height: 100%; object-fit: cover;">
        {% else %}
        <div
            style="width: 100%; height: 100%; background: #333; display: flex; align-items: center; justify-content: center;">
            <i class="fas fa-music" style="font-size: 5rem; opacity: 0.5;"></i>
        </div>
        {% endif %}
    </div>
    <div>
        <h4
            style="text-transform: uppercase; letter-spacing: 2px; font-size: 0.9rem; margin-bottom: 10px; opacity: 0.8;">
            {{ album.get_type_display }}</h4>
        <h1 style="font-size: 4rem; margin-bottom: 10px; line-height: 1;">{{ album.title }}</h1>
        <div style="display: flex; align-items: center; gap: 10px; font-size: 1.1rem;">
            <a href="{% url 'music:performer_detail' album.performer.pk %}"
                style="color: white; text-decoration: none; font-weight: 600;">
                {{ album.performer.name }}
            </a>
            <span>•</span>
            <span>{{ album.release_year }}</span>
            <span>•</span>
            <span>{{ album.compositions.count }} треков</span>
        </div>
    </div>
</div>

<div class="glass-card" style="padding: 0;">
    <table style="width: 100%; border-collapse: collapse;">
        <thead>
            <tr style="border-bottom: 1px solid rgba(255,255,255,0.1); text-align: left;">
                <th style="padding: 15px 20px; width: 50px;">#</th>
                <th style="padding: 15px 20px;">Название</th>
                <th style="padding: 15px 20px;">Прослушивания</th>
                <th style="padding: 15px 20px; text-align: right;">Длительность</th>
                <th style="padding: 15px 20px; width: 150px;"></th>
            </tr>
        </thead>
        <tbody>
            {% for track in album.compositions.all %}
            <tr style="border-bottom: 1px solid rgba(255,255,255,0.05); transition: background 0.2s;">
                <td style="padding: 15px 20px; opacity: 0.7;">{{ forloop.counter }}</td>
                <td style="padding: 15px 20px;">
                    <div style="font-weight: 600;">{{ track.title }}</div>
                    <div style="font-size: 0.8rem; opacity: 0.6;">{{ track.style }}</div>
                </td>
                <td style="padding: 15px 20px; opacity: 0.7;">{{ track.play_count }}</td>
                <td style="padding: 15px 20px; text-align: right; opacity: 0.7;">{{ track.duration }}</td>
                <td style="padding: 15px 20px;">
                    <div style="display: flex; justify-content: flex-end; align-items: center; gap: 15px;">
                        <button
                            onclick="playTrack('{{ track.audio_file.url }}', '{{ track.title }}', '{{ album.performer.name }}', {{ track.pk }})"
                            style="background: none; border: none; color: white; cursor: pointer; font-size: 1.2rem;">
                            <i class="fas fa-play"></i>
                        </button>
                        <button onclick="interact('like_composition', {{ track.pk }}, this)"
                            style="background: none; border: none; color: white; cursor: pointer; font-size: 1.2rem;">
                            <i class="far fa-heart"></i>
                        </button>
                        <a href="{% url 'music:download_composition' track.pk %}"
                            style="color: white; text-decoration: none; font-size: 1.2rem;">
                            <i class="fas fa-download"></i>
                        </a>
                    </div>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>

<script>
    function interact(type, id, btn) {
        fetch(`/interact/${type}/${id}/`, {
            method: 'POST',
            headers: {
                'X-CSRFToken': '{{ csrf_token }}'
            }
        }).then(response => response.json())
            .then(data => {
                if (data.status === 'added') {
                    if (btn) {
                        const icon = btn.querySelector('i');
                        icon.classList.remove('far');
                        icon.classList.add('fas');
                        icon.style.color = 'var(--accent)';
                    }
                } else if (data.status === 'removed') {
                    if (btn) {
                        const icon = btn.querySelector('i');
                        icon.classList.remove('fas');
                        icon.classList.add('far');
                        icon.style.color = 'white';
                    }
                } else {
                    console.error('Error:', data.error);
                }
            });
    }
</script>
{% endblock %}