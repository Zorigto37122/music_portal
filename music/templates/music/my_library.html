{% extends 'music/base.html' %}

{% block content %}
<h1 class="section-title" style="margin-bottom: 30px;">Моя библиотека</h1>

<div style="margin-bottom: 40px;">
    <h2 class="section-title" style="font-size: 1.5rem; margin-bottom: 20px;">Избранные исполнители</h2>
    {% if favorite_performers %}
    <div class="grid" style="grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));">
        {% for performer in favorite_performers %}
        <div class="glass-card" style="padding: 20px; text-align: center;">
            <div style="width: 100px; height: 100px; border-radius: 50%; overflow: hidden; margin: 0 auto 15px; border: 2px solid var(--accent);">
                {% if performer.photo %}
                <img src="{{ performer.photo.url }}" alt="{{ performer.name }}" style="width: 100%; height: 100%; object-fit: cover;">
                {% else %}
                <div style="width: 100%; height: 100%; background: #333; display: flex; align-items: center; justify-content: center;">
                    <i class="fas fa-user" style="font-size: 2rem; opacity: 0.5;"></i>
                </div>
                {% endif %}
            </div>
            <h3 style="font-size: 1.1rem; margin-bottom: 5px;">
                <a href="{% url 'music:performer_detail' performer.pk %}" style="color: white; text-decoration: none;">{{ performer.name }}</a>
            </h3>
            <p style="font-size: 0.8rem; opacity: 0.7;">{{ performer.get_type_display }}</p>
        </div>
        {% endfor %}
    </div>
    {% else %}
    <div class="glass-card" style="padding: 40px; text-align: center;">
        <p style="opacity: 0.7; font-size: 1.1rem;">Нет избранных исполнителей</p>
    </div>
    {% endif %}
</div>

<div style="margin-bottom: 40px;">
    <h2 class="section-title" style="font-size: 1.5rem; margin-bottom: 20px;">Понравившиеся композиции</h2>
    {% if liked_compositions %}
    <div class="glass-card" style="padding: 0;">
        <table style="width: 100%; border-collapse: collapse;">
            <thead>
                <tr style="border-bottom: 1px solid rgba(255,255,255,0.1); text-align: left;">
                    <th style="padding: 15px 20px; width: 50px;">#</th>
                    <th style="padding: 15px 20px;">Название</th>
                    <th style="padding: 15px 20px;">Исполнитель</th>
                    <th style="padding: 15px 20px;">Альбом</th>
                    <th style="padding: 15px 20px; width: 150px;"></th>
                </tr>
            </thead>
            <tbody>
                {% for track in liked_compositions %}
                <tr style="border-bottom: 1px solid rgba(255,255,255,0.05);">
                    <td style="padding: 15px 20px; opacity: 0.7;">{{ forloop.counter }}</td>
                    <td style="padding: 15px 20px; font-weight: 600;">{{ track.title }}</td>
                    <td style="padding: 15px 20px;">
                        <a href="{% url 'music:performer_detail' track.album.performer.pk %}" style="color: white; text-decoration: none;">
                            {{ track.album.performer.name }}
                        </a>
                    </td>
                    <td style="padding: 15px 20px; opacity: 0.7;">{{ track.album.title }}</td>
                    <td style="padding: 15px 20px;">
                        <div style="display: flex; justify-content: flex-end; align-items: center; gap: 15px;">
                            <button onclick="playTrack('{{ track.audio_file.url }}', '{{ track.title }}', '{{ track.album.performer.name }}', {{ track.pk }})"
                                style="background: none; border: none; color: white; cursor: pointer; font-size: 1.2rem;">
                                <i class="fas fa-play"></i>
                            </button>
                            <a href="{% url 'music:download_composition' track.pk %}"
                                style="color: white; text-decoration: none; font-size: 1.2rem;">
                                <i class="fas fa-download"></i>
                            </a>
                        </div>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
    {% else %}
    <div class="glass-card" style="padding: 40px; text-align: center;">
        <p style="opacity: 0.7; font-size: 1.1rem;">Нет понравившихся композиций</p>
    </div>
    {% endif %}
</div>

<div style="margin-bottom: 40px;">
    <h2 class="section-title" style="font-size: 1.5rem; margin-bottom: 20px;">Прослушанные композиции</h2>
    {% if listened_compositions %}
    <div class="glass-card" style="padding: 0;">
        <table style="width: 100%; border-collapse: collapse;">
            <thead>
                <tr style="border-bottom: 1px solid rgba(255,255,255,0.1); text-align: left;">
                    <th style="padding: 15px 20px; width: 50px;">#</th>
                    <th style="padding: 15px 20px;">Название</th>
                    <th style="padding: 15px 20px;">Исполнитель</th>
                    <th style="padding: 15px 20px;">Прослушивания</th>
                    <th style="padding: 15px 20px; width: 150px;"></th>
                </tr>
            </thead>
            <tbody>
                {% for track in listened_compositions|slice:":20" %}
                <tr style="border-bottom: 1px solid rgba(255,255,255,0.05);">
                    <td style="padding: 15px 20px; opacity: 0.7;">{{ forloop.counter }}</td>
                    <td style="padding: 15px 20px; font-weight: 600;">{{ track.title }}</td>
                    <td style="padding: 15px 20px;">
                        <a href="{% url 'music:performer_detail' track.album.performer.pk %}" style="color: white; text-decoration: none;">
                            {{ track.album.performer.name }}
                        </a>
                    </td>
                    <td style="padding: 15px 20px; opacity: 0.7;">{{ track.play_count }}</td>
                    <td style="padding: 15px 20px;">
                        <div style="display: flex; justify-content: flex-end; align-items: center; gap: 15px;">
                            <button onclick="playTrack('{{ track.audio_file.url }}', '{{ track.title }}', '{{ track.album.performer.name }}', {{ track.pk }})"
                                style="background: none; border: none; color: white; cursor: pointer; font-size: 1.2rem;">
                                <i class="fas fa-play"></i>
                            </button>
                            <a href="{% url 'music:download_composition' track.pk %}"
                                style="color: white; text-decoration: none; font-size: 1.2rem;">
                                <i class="fas fa-download"></i>
                            </a>
                        </div>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
    {% else %}
    <div class="glass-card" style="padding: 40px; text-align: center;">
        <p style="opacity: 0.7; font-size: 1.1rem;">Нет прослушанных композиций</p>
    </div>
    {% endif %}
</div>

<div>
    <h2 class="section-title" style="font-size: 1.5rem; margin-bottom: 20px;">Загруженные композиции</h2>
    {% if downloaded_compositions %}
    <div class="glass-card" style="padding: 0;">
        <table style="width: 100%; border-collapse: collapse;">
            <thead>
                <tr style="border-bottom: 1px solid rgba(255,255,255,0.1); text-align: left;">
                    <th style="padding: 15px 20px; width: 50px;">#</th>
                    <th style="padding: 15px 20px;">Название</th>
                    <th style="padding: 15px 20px;">Исполнитель</th>
                    <th style="padding: 15px 20px;">Альбом</th>
                    <th style="padding: 15px 20px; width: 150px;"></th>
                </tr>
            </thead>
            <tbody>
                {% for track in downloaded_compositions %}
                <tr style="border-bottom: 1px solid rgba(255,255,255,0.05);">
                    <td style="padding: 15px 20px; opacity: 0.7;">{{ forloop.counter }}</td>
                    <td style="padding: 15px 20px; font-weight: 600;">{{ track.title }}</td>
                    <td style="padding: 15px 20px;">
                        <a href="{% url 'music:performer_detail' track.album.performer.pk %}" style="color: white; text-decoration: none;">
                            {{ track.album.performer.name }}
                        </a>
                    </td>
                    <td style="padding: 15px 20px; opacity: 0.7;">{{ track.album.title }}</td>
                    <td style="padding: 15px 20px;">
                        <div style="display: flex; justify-content: flex-end; align-items: center; gap: 15px;">
                            <button onclick="playTrack('{{ track.audio_file.url }}', '{{ track.title }}', '{{ track.album.performer.name }}', {{ track.pk }})"
                                style="background: none; border: none; color: white; cursor: pointer; font-size: 1.2rem;">
                                <i class="fas fa-play"></i>
                            </button>
                            <a href="{% url 'music:download_composition' track.pk %}"
                                style="color: white; text-decoration: none; font-size: 1.2rem;">
                                <i class="fas fa-download"></i>
                            </a>
                        </div>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
    {% else %}
    <div class="glass-card" style="padding: 40px; text-align: center;">
        <p style="opacity: 0.7; font-size: 1.1rem;">Нет загруженных композиций</p>
    </div>
    {% endif %}
</div>
{% endblock %}
